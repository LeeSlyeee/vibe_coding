[b2g_strategy_dashboard]

# 🚀 B2G/B2B 핵심 전략: "실명 인증 기반의 정밀 케어 대시보드"

## 목표 (Business Goal)

정부 기관(B2G) 및 기업(B2B) 담당자가 **"실제 위험군을 정확히 식별하고 즉시 개입"** 할 수 있도록, **100% 신뢰할 수 있는 실명 데이터 기반의 강력한 분석 도구**를 제공한다.
(※ 2026.02 Update: Guest 모드 폐지 및 실명 인증 강제화로 데이터 정합성 100% 달성)

## 🛠️ 1. 정밀 ROI 대시보드 (Real-Name Statistics)

**목표**: 단순 통계가 아닌, **'누가 위험한지'** 정확히 파악하여 사고를 예방.

- **Endpoint**: `GET /api/b2g/dashboard/stats`
- **핵심 변경사항**:
  - 기존: 익명/Guest 혼재로 인한 추정치 제공
  - **변경: 로그인 기반의 실명 데이터(Authenticated Data)만 집계**
- **주요 데이터**:
  1. **실시간 연동 현황**:
     - 전체 대상자 vs 연동 완료자(로그인 & 코드 입력)
     - **미연동자 리스트** (독려 대상 자동 추출)
  2. **위험군 정밀 타격 (Targeting)**:
     - **관심군(Yellow)**: 불면증 호소, 기분 점수 하락세 (조기 발견)
     - **고위험군(Red)**: **자살/자해 키워드**, PHQ-9 고위험군 (**실명 식별 가능**)
  3. **조직 건강도**:
     - 부서/센터별 평균 스트레스 지수 비교
     - 긍정 키워드 클라우드 (조직 내 주된 관심사 파악)

## 📊 2. 원클릭 엑셀 보고서 (Excel Export)

**목표**: 공무원/담당자의 '보고 업무' 제로화 + **데이터 무결성 보장**.

- **Endpoint**: `GET /api/b2g/export/report`
- **기능**:
  - **필터링 강화**: '미연동자 제외', '고위험군만 추출' 등 정밀 필터 제공.
  - **개인정보 보호 등급제**:
    - **Grade C (일반)**: 이름 마스킹 (`이*라`), 사번/식별코드만 노출.
    - **Grade A (관리자)**: **실명 포함** (상담/개입용). _별도 비밀번호 인증 필수._
  - **포함 항목**:
    - 기본: 날짜, 기분 점수, 수면 시간
    - 심화: AI 분석 요약(한 줄), **최근 2주 위험 감지 횟수**

## 🛡️ 3. 보안 감사 로그 (Audit Trail) - 강화됨

**목표**: **실명 데이터** 접근에 대한 **절대적인 추적성(Traceability)** 확보.

- **Collection**: `b2g_audit_logs`
- **배경**: Guest 모드 폐지로 모든 데이터가 개인정보가 됨에 따라 보안 수준 격상.
- **구현 내용**:
  - **Read-Once Log**: 관리자가 특정인의 상세 일기를 열람할 때마다 **사유 입력 강제**.
  - **Export Alert**: 10명 이상의 실명 데이터를 엑셀로 받을 시 상급 관리자에게 **자동 알림**.
  - **Log 조회 API**: `GET /api/b2g/logs` (감사팀 전용)
  - **필드**: `admin_id`, `access_reason`, `target_user_realname`, `timestamp`, `client_ip`

---

## 📅 실행 계획 (Action Plan) - 2026.02 Revised

### Phase 1: 데이터 정합성 검증 (Completed)

- [x] **Guest 모드 전면 폐지**: `LocalDataManager` 및 `APIService`에서 익명 동기화 차단.
- [x] **Zombie State 방지**: 앱 실행 시 유저명(`authUsername`) 자동 복구 로직 탑재.
- [x] **서버 검증 로직 강화**: 토큰 없는 데이터 유입 원천 봉쇄 (`b2g_routes.py`).

### Phase 2: 대시보드 고도화 (In Progress)

- [ ] **Risk Level 반영**: `users` 테이블의 `risk_level` 필드를 대시보드 정렬 기준으로 적용.
- [ ] **미연동자 현황판**: 전체 인원 대비 실제 로그인 연동 비율 시각화.

### Phase 3: 보안 및 보고서

- [ ] **Grade A 다운로드 인증**: 엑셀 다운로드 시 2차 인증(비밀번호/OTP) 모달 구현.
- [ ] **Audit Log UI**: 관리자 활동 로그를 조회할 수 있는 Admin 페이지 구축.
