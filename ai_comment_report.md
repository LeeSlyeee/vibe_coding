# AI 코멘트 품질 개선 보고서

## 1. 진단: 왜 코멘트가 "맥락에 맞지 않는가?"

코드베이스(`ai_analysis.py`)를 조사한 결과, AI가 감정 분석은 정확하게 수행함에도 불구하고 일반적이거나 "동문서답"하는 반응을 보이는 치명적인 구현 오류를 발견했습니다.

### A. "뇌 연결 끊김" 오류 (The "Disconnected Brain" Error)

창의적이고 맥락을 파악하는 조언 생성을 담당하는 `generate_kogpt2_comment` 함수가 **호출 가능한 메서드로 존재하지 않았습니다**.

- 해당 코드는 존재했지만, 실수로 다른 함수(`generate_label_comment`) 내부의 `return` 문 뒤에 붙여넣어져 있었습니다.
- **결과**: 이 코드는 "죽은 코드(Dead Code)"가 되어 절대 실행되지 않았습니다. 시스템이 이 기능을 호출하려 할 때마다 오류가 발생했고, 안전장치가 작동하여 "당신의 마음을 이해해요"나 "오늘 하루도 수고했어요"와 같은 기본 메시지만 반환했습니다.

### B. 우선순위 설정 오류 (Priority Mismatch)

현재 시스템은 **생성형 조언(Generative Advice)**보다 **사전 정의된 라벨 메시지(Pre-defined Label Messages)**(예: "배신" -> "배신은 고통스럽습니다.")를 우선시하도록 설정되어 있습니다.

- 코드가 수정되더라도 시스템은 "사전"을 먼저 확인합니다. "배신"이라는 키워드를 찾으면 사전적 정의를 반환해버리고, 구체적인 _이야기_(예: "친구가 내 돈 10만원을 떼어먹었다")는 무시합니다.
- **결과**: AI는 누가, 무엇을, 어디서와 같은 구체적인 맥락을 무시하고, 감지된 감정에 대한 격언만 읊게 됩니다.

---

## 2. 해결 방안

코멘트를 "맥락에 맞게" 그리고 "공감할 수 있게" 만들기 위해 다음과 같은 대수술을 진행해야 합니다.

### 1단계: KoGPT-2 재연결 (코드 복구)

- 파묻힌 코드 블록을 추출하여 `def generate_kogpt2_comment(self, user_input, emotion_label):`로 올바르게 정의합니다.
- 메인 로직에서 이 메서드에 접근할 수 있도록 합니다.

### 2단계: 우선순위 역전 (로직 업데이트)

- **기존**: 키워드 > 라벨 뱅크 (일반적) > KoGPT (맥락)
- **변경**: 키워드 > **KoGPT (맥락)** > 라벨 뱅크 (최후의 수단)
- **이유**: AI가 구체적인 상황을 먼저 이해하려고 *시도*해야 합니다. AI가 실패하거나 불확실할 때만 일반적인 라벨 뱅크를 사용해야 합니다.

### 3단계: 프롬프트 엔지니어링 (뇌 훈련)

- KoGPT에 전달되는 프롬프트를 업데이트하여 *사건*과의 상호작용을 명시적으로 요구합니다.
- **기존 프롬프트**: "User wrote X. Counselor:"
- **새로운 프롬프트**:
  ```text
  사용자 일기: [사건 설명]
  감지된 감정: [감정]
  상담 목표: [사건]과 관련하여 사용자에게 구체적으로 공감하기.
  상담사:
  ```

## 3. 실행

즉시 이 수정 사항들을 적용할 준비가 되었습니다. 모델 자체(정확도 72%)는 훌륭합니다. 단지 "언어 중추"의 배선만 다시 연결하면 됩니다.
