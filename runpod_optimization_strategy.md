# RunPod Serverless 최적화 및 안정성 전략 보고서

본 문서는 제한된 비용($150) 내에서 **100명의 동시 접속자가 몰리는 상황**을 효과적으로 방어하고, 사용자 경험(UX)을 유지하기 위해 적용된 **Serverless 최적화 전략**을 기술합니다.

## 1. 핵심 전략: "비용 효율성"과 "안정성"의 균형

24시간 서버를 켜두는 것은 사용자 트래픽이 적은 시간대(낮)에 불필요한 비용을 발생시킵니다. 따라서 **Serverless(사용 만큼 지불)** 구조를 유지하되, **트래픽 폭주 시 발생하는 지연(Cold Start, Queue)**을 앱과 서버가 유연하게 견디도록 설계했습니다.

### 💰 비용 관리 (Cost Management)

- **전략:** **RunPod Serverless** 유지
- **이유:** 사용자가 없는 시간대(낮/새벽)에는 비용이 $0입니다. 오직 사용자가 몰리는 저녁 시간대에만 비용이 발생하므로 $150 예산을 가장 효율적으로 사용할 수 있습니다.

## 2. 기술적 해결책 (Architecture)

### 🛡️ 백엔드 (Server Side) - "끈기 있는 중계소"

1.  **Gunicorn Threaded Mode 적용:**
    - 기존: 2명 동시 접속 시 차단 (Process 방식)
    - **변경:** **동시 100명 처리 가능** (Threaded Mode: 4 Workers x 25 Threads)
    - 효과: 217 서버가 병목이 되어 터지는 현상을 완벽 차단했습니다.
2.  **5분 대기 (Timeout Extension):**
    - RunPod GPU가 켜지는 데 걸리는 시간(Cold Start)이나 대기열(Queue)이 길어질 경우를 대비해, 서버가 최대 **300초(5분)**까지 연결을 끊지 않고 기다립니다.
3.  **우아한 실패 (Graceful Degradation):**
    - 만약 5분을 넘기더라도 "500 Internal Server Error"를 띄우지 않습니다.
    - 대신 **"죄송해요, 지금 많은 분들의 이야기를 듣고 있어서 답변이 늦어지고 있어요. 잠시 후 다시 시도해주시겠어요? 🙇🏻‍♂️"** 라는 **위로형 답변**을 전송하여 사용자가 에러로 인식하지 않게 합니다.

### 📱 iOS 앱 (Client Side) - "인내심 있는 동반자"

1.  **Timeout 동기화:**
    - 앱의 네트워크 대기 시간을 기존 180초에서 **300초(5분)**로 연장했습니다.
    - 서버가 열심히 답을 준비해왔는데 앱이 먼저 "지루해!" 하고 끊어버리는 사태를 방지합니다.
2.  **친절한 UI 피드백:**
    - 오래 걸리는 동안 막연히 멈춘 화면을 보여주는 대신, **"AI가 답변을 생각하고 있어요..."**, **"거의 다 되었습니다!"** 같은 문구로 사용자를 안심시킵니다.

## 3. 현실적인 시나리오 시뮬레이션 (100명 동시 접속 시)

| 상황                     | 사용자 경험 (UX)                                              | 시스템 상태                                         | 비용        |
| :----------------------- | :------------------------------------------------------------ | :-------------------------------------------------- | :---------- |
| **선두 그룹 (1~20등)**   | **[쾌적]** 5~10초 내 답변 도착                                | RunPod GPU 즉시 할당 및 처리                        | 발생 ($0/h) |
| **중간 그룹 (21~80등)**  | **[대기]** 30초~2분 소요 <br> _"조금만 기다려주세요..."_      | RunPod 대기열(Queue)에서 순차 처리                  | 발생 ($0/h) |
| **후발 그룹 (81~100등)** | **[지연/안내]** 3~5분 소요 <br> _"죄송해요, 잠시 후 다시..."_ | 5분 초과 시 서버가 **안내 메시지** 반환 (에러 창 X) | 발생 ($0/h) |

## 4. 결론

이 전략은 **"서비스가 절대 죽지 않는다"**는 것을 보장합니다.
100명 전원이 동시에 칼같이 답변을 받지는 못하더라도, **단 한 명의 사용자도 흉한 에러 창을 보거나 앱이 튕기는 경험을 하지 않습니다.**

이것이 **150달러 예산**으로 구현할 수 있는 가장 현실적이고 강력한 방어책입니다.
