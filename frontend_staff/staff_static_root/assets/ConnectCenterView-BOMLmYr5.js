import{c as v,a as t,f as i,b as w,d as C,m as k,t as g,e as b,n as $,i as a,p as m,k as V,l as f}from"./index-D6lzrY5p.js";const R={class:"flex min-h-screen flex-col items-center justify-center bg-yellow-200 p-6"},B={class:"w-full max-w-md rounded-lg bg-white p-6 shadow-lg"},N={class:"flex gap-2"},D=["disabled"],E={key:0,class:"mt-2 text-sm text-red-600"},M={key:1,class:"mt-6 rounded border border-indigo-100 bg-indigo-50 p-4"},S={class:"font-bold text-indigo-900"},U={class:"text-sm text-indigo-700"},I={class:"mt-6 text-center"},j={__name:"ConnectCenterView",setup(K){const d=a(""),o=a(null),c=a(null),u=a(!1),l=a(""),y=a(""),p=V(),x=async()=>{var r,e,n;u.value=!0,l.value="",o.value=null,c.value=null,y.value="";try{const s=await m.post("centers/verify-code/",{center_code:d.value});s.data.valid&&(o.value=s.data.center,c.value=s.data.verification_code_id)}catch(s){console.error("DEBUG ERR:",s);const h=`URL: ${(r=s.config)==null?void 0:r.url}
Status: ${(e=s.response)==null?void 0:e.status}
Res: ${JSON.stringify((n=s.response)==null?void 0:n.data)}`;alert(`[디버그 정보]
${h}

에러: ${s.message}`),s.response&&s.response.data.error?l.value=s.response.data.error:l.value="코드 확인 중 오류가 발생했습니다."}finally{u.value=!1}},_=async()=>{var r,e,n;if(o.value&&confirm(`'${o.value.name}'과 연동하시겠습니까?

※ 연동 시 귀하의 감정 데이터 요약본이 담당자에게 공유됩니다.`))try{await m.post("connect/request/",{center_id:o.value.id,verification_code_id:c.value}),alert("연동이 완료되었습니다!"),p.push("/")}catch(s){((r=s.response)==null?void 0:r.status)===409?(alert("이미 연동된 기관입니다."),p.push("/")):alert("연동 요청 실패: "+(((n=(e=s.response)==null?void 0:e.data)==null?void 0:n.error)||"알 수 없는 오류"))}};return(r,e)=>(f(),v("div",R,[t("div",B,[e[3]||(e[3]=t("h2",{class:"mb-6 text-center text-2xl font-bold text-gray-800"},"기관 연동 (Fix Version)",-1)),e[4]||(e[4]=t("p",{class:"mb-4 text-sm text-gray-600"},[i(" 담당자에게 전달받은 "),t("strong",null,"일회용 인증 코드"),i("를 입력해주세요."),t("br"),i(" (예: X7Y2Z9...) ")],-1)),t("div",N,[w(t("input",{"onUpdate:modelValue":e[0]||(e[0]=n=>d.value=n),type:"text",placeholder:"인증 코드 입력",class:"flex-1 rounded border border-gray-300 p-2 uppercase focus:border-indigo-500 focus:ring-indigo-500",onKeyup:k(x,["enter"])},null,544),[[C,d.value]]),t("button",{onClick:x,disabled:u.value,class:"rounded bg-indigo-600 px-4 py-2 font-bold text-white hover:bg-indigo-700 disabled:opacity-50"}," 코드 확인 (v2) ",8,D)]),l.value?(f(),v("p",E,g(l.value),1)):b("",!0),o.value?(f(),v("div",M,[t("h3",S,g(o.value.name),1),t("p",U,g(o.value.region),1),e[2]||(e[2]=t("div",{class:"mt-4 border-t border-indigo-200 pt-3 text-xs text-gray-600"},[t("p",{class:"mb-2"},[i("⚠️ 연동 시 "),t("strong",null,"위험 징후 데이터"),i("가 공유됩니다.")])],-1)),t("button",{onClick:_,class:"mt-2 w-full rounded bg-indigo-600 px-4 py-2 text-sm font-bold text-white hover:bg-indigo-700"}," 동의하고 연동하기 ")])):b("",!0),t("div",I,[t("button",{onClick:e[1]||(e[1]=n=>$(p).push("/")),class:"text-sm text-gray-500 hover:text-gray-700"},"돌아가기")])])]))}};export{j as default};
